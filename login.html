<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TMS - Login</title>
  <link rel="stylesheet" href="trainingmanagement.css">
  <link rel="icon" href="file:///C:Users\r.santos\Documents\TMS\/images/favicon.png" type="image/png">
</head>
<body>
<div class="header">
	<h1>Training Management System<h1>
	<h3>TMS<h3>
</div>
  <div class="login-container">
    <div class="login-form">
      <h2>Login</h2>
      <form id="loginForm" action="#" method="post" onsubmit="return validateLogin();">
        <div class="input-group">
          <label for="username">Mail</label>
          <input type="text" id="username" name="username" required>
        </div>
        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required>
        </div>
        <button type="submit" class="login-button">Login</button>
        <div class="extra-links">
          <a href="#">Forgot Password?</a>
          <a href="#">Create an Account</a>
        </div>
      </form>
    </div>
  </div>

<script>
<script>
// Initialize localStorage variables only if not already set
if (localStorage.getItem("isLoggedIn") === null) {
    localStorage.setItem("isLoggedIn", "false");
}
if (localStorage.getItem("loggedInEmail") === null) {
    localStorage.setItem("loggedInEmail", "");
}
if (localStorage.getItem("loggedInName") === null) {
    localStorage.setItem("loggedInName", "");
}

document.addEventListener('DOMContentLoaded', function () {
    const isLoggedIn = localStorage.getItem("isLoggedIn");

    // If logged in, go straight to home page
    if (isLoggedIn === "true") {
        window.location.href = "index.html";
    }
});

function validateLogin() {
    const username = document.getElementById('username').value.trim().toLowerCase();
    const password = document.getElementById('password').value.trim();

    let trainerStorage = JSON.parse(localStorage.getItem("trainerStorage")) || [];
    console.log("trainerStorage:", trainerStorage);

    // Master Trainer login
    if (username === "trainer@esky.com" && password === "TEST") {
        loginSuccess(username, "Master Trainer");
        alert("Logged in as Master Trainer");
        return false;
    }

    // Check stored trainers
    const user = trainerStorage.find(user => user.email.trim().toLowerCase() === username);
    console.log("user found:", user);

    if (user && user.password.trim() === password) {
        loginSuccess(username, user.name);
        return false;
    }

    alert("Invalid username or password!");
    return false;
}

function loginSuccess(email, name) {
    localStorage.setItem("isLoggedIn", "true");
    localStorage.setItem("loggedInEmail", email);
    localStorage.setItem("loggedInName", name);

    console.log("loggedInEmail =", email);
    console.log("loggedInName =", name);

    window.location.href = "index.html";
}
</script>

</script>


</body>
</html>
